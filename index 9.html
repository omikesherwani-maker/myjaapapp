<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mindful Jaap - Branded Certificate</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --bg: #ffffff; --text: #000; --accent: #ff9800; --border: #eee; --card: #f9f9f9; }
        body.dark { --bg: #000; --text: #fff; --border: #222; --card: #111; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; transition: 0.3s; height: 100vh; display: flex; flex-direction: column; overflow: hidden; text-align: center; }
        
        #onboarding { position: fixed; inset: 0; background: var(--bg); z-index: 200; display: flex; flex-direction: column; justify-content: center; padding: 30px; }
        input { padding: 15px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--border); background: var(--card); color: var(--text); font-size: 16px; }
        
        .header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .main-ui { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
        .counter-circle { width: 220px; height: 220px; border-radius: 50%; border: 8px solid var(--accent); display: flex; flex-direction: column; justify-content: center; }
        #main-num { font-size: 70px; font-weight: bold; }

        /* Certificate Styles */
        #certificateModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 150; align-items: center; justify-content: center; padding: 10px; }
        #certificateContent { 
            background: #fff; color: #000; padding: 25px; border-radius: 10px; width: 100%; max-width: 350px; 
            text-align: center; position: relative; border: 8px double #d4af37; box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background-image: radial-gradient(circle, #fff 70%, #fdfbf0);
        }
        #certificateContent h2 { color: #d4af37; font-size: 1.8em; margin: 5px 0; font-family: 'Times New Roman', serif; }
        .cert-label { font-size: 0.9em; color: #555; }
        .cert-value { font-size: 1.2em; font-weight: bold; border-bottom: 1px solid #ddd; display: inline-block; min-width: 150px; margin: 5px 0; }
        
        /* Branding Section on Certificate */
        .cert-branding { 
            margin-top: 20px; padding-top: 15px; border-top: 1px dashed #ccc; 
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .ig-icon { width: 20px; height: 20px; fill: #E1306C; }
        .page-name { font-weight: bold; color: #000; font-size: 14px; }

        .modal { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 100; padding: 20px; overflow-y: auto; text-align: left; }
        .flower { position: fixed; top: -20px; font-size: 24px; animation: fall linear forwards; pointer-events: none; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }
    </style>
</head>
<body>

    <div id="onboarding">
        <h1>Welcome</h1>
        <p>Enter details to start your Sadhna</p>
        <input type="text" id="userName" placeholder="Name">
        <input type="text" id="userLoc" placeholder="Location (e.g. Raipur, India)">
        <button onclick="saveUser()" style="background: var(--accent); color: white; border: none; padding: 15px; border-radius: 10px; font-size: 18px; cursor: pointer;">Start Sadhna</button>
    </div>

    <div class="header">
        <div id="u-display" style="font-size: 14px; font-weight: bold;">‡§®‡§Æ‡§∏‡•ç‡§§‡•á</div>
        <div>
            <button onclick="openModal('historyModal')" style="background: none; border: 1px solid var(--text); color: var(--text); padding: 5px 12px; border-radius: 15px;">Stats</button>
            <button onclick="openModal('settingsModal')" style="background:none; border:none; font-size: 18px;">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="main-ui" onclick="handleTap()">
        <div id="active-mantra" style="margin-bottom: 15px; font-size: 20px; color: var(--accent);">‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø</div>
        <div class="counter-circle">
            <div id="main-num">0</div>
            <div style="font-size: 10px; opacity: 0.6;">JAPS</div>
        </div>
        <div id="mala-info" style="margin-top: 20px; font-size: 16px; opacity: 0.7;">Mala: 0 | Goal: 0/1</div>
    </div>

    <div id="certificateModal">
        <div id="certificateContent">
            <div style="font-size: 30px;">üïâÔ∏è</div>
            <h2>‡§∏‡§æ‡§ß‡§®‡§æ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§™‡§§‡•ç‡§∞</h2>
            <p class="cert-label">‡§Ø‡§π ‡§ó‡•å‡§∞‡§µ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§ï‡§ø</p>
            <div class="cert-value" id="cert-name">Name</div>
            <p class="cert-label">‡§®‡§ø‡§µ‡§æ‡§∏‡•Ä: <span id="cert-location">Location</span></p>
            <p class="cert-label">‡§®‡•á ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∂‡•ç‡§∞‡§¶‡•ç‡§ß‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• <b><span id="cert-malas"></span></b> ‡§Æ‡§æ‡§≤‡§æ ‡§ï‡§æ ‡§ú‡§æ‡§™ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§ø‡§Ø‡§æ‡•§</p>
            <p style="margin: 10px 0;"><b>Mantra:</b> <span id="cert-mantra"></span></p>
            <p class="cert-label" id="cert-date"></p>
            
            <div class="cert-branding">
                <svg class="ig-icon" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                <span class="page-name">mindful.jaap</span>
            </div>

            <button onclick="downloadCert()" style="background:var(--accent); color:white; border:none; padding:10px 20px; border-radius:10px; margin-top:15px;">Download</button>
            <button onclick="closeModal('certificateModal')" style="background:gray; color:white; border:none; padding:10px 20px; border-radius:10px; margin-left:5px;">Close</button>
        </div>
    </div>

    <div id="historyModal" class="modal">
        <button class="close-btn" onclick="closeModal('historyModal')">Back</button>
        <h2>Stats</h2><div id="history-list"></div>
    </div>

    <div id="settingsModal" class="modal">
        <button class="close-btn" onclick="closeModal('settingsModal')">Back</button>
        <h2>Settings</h2>
        <p>Goal: <select id="goalSet" onchange="updateGoal()"><option value="1">1 Mala</option><option value="11">11 Malas</option></select></p>
        <p>Mantra: <select id="mList" onchange="changeMantra()">
            <option value="‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø">‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø</option><option value="‡•ê ‡§π‡§Æ ‡§π‡§®‡•Å‡§Æ‡§Ç‡§§‡•á ‡§®‡§Æ‡§É">‡•ê ‡§π‡§Æ ‡§π‡§®‡•Å‡§Æ‡§Ç‡§§‡•á ‡§®‡§Æ‡§É</option>
        </select></p>
    </div>

    <audio id="click" src="https://www.soundjay.com/buttons/sounds/button-16.mp3"></audio>

    <script>
        let db = JSON.parse(localStorage.getItem('m_v4_db')) || { total: 0, malas: 0, goal: 1 };
        let user = JSON.parse(localStorage.getItem('m_u')) || null;
        let activeM = "‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø";

        if(user) { document.getElementById('onboarding').style.display='none'; document.getElementById('u-display').innerText=user.name; }

        function saveUser() {
            let n=document.getElementById('userName').value; let l=document.getElementById('userLoc').value;
            if(n && l) { user={name:n, loc:l}; localStorage.setItem('m_u', JSON.stringify(user)); location.reload(); }
        }

        function handleTap() {
            db.total++; let b = db.total % 108;
            document.getElementById('click').currentTime=0; document.getElementById('click').play();
            if(b===0 && db.total!==0) {
                db.malas++; spawnFlowers();
                if(db.malas >= db.goal) showCert();
            }
            updateUI();
        }

        function showCert() {
            document.getElementById('cert-name').innerText = user.name;
            document.getElementById('cert-location').innerText = user.loc;
            document.getElementById('cert-malas').innerText = db.malas;
            document.getElementById('cert-mantra').innerText = activeM;
            document.getElementById('cert-date').innerText = new Date().toLocaleDateString();
            document.getElementById('certificateModal').style.display = 'flex';
        }

        function downloadCert() {
            const cert = document.getElementById('certificateContent');
            html2canvas(cert, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Mindful_Jaap_Certificate.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function updateUI() {
            localStorage.setItem('m_v4_db', JSON.stringify(db));
            document.getElementById('main-num').innerText = db.total;
            document.getElementById('mala-info').innerText = `Mala: ${db.malas} | Goal: ${db.malas}/${db.goal}`;
        }
        function openModal(id) { document.getElementById(id).style.display='block'; }
        function closeModal(id) { document.getElementById(id).style.display='none'; }
        function spawnFlowers() {
            for(let i=0; i<20; i++){
                let f=document.createElement('div'); f.className='flower'; f.innerText='üå∏';
                f.style.left=Math.random()*100+'vw'; f.style.animationDuration=(Math.random()*2+2)+'s';
                document.body.appendChild(f); setTimeout(()=>f.remove(), 4000);
            }
        }
        updateUI();
    </script>
</body>
</html>
